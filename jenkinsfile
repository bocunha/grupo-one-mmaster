pipeline {
    agent any

    parameters {
        string(name: 'DECISION', defaultValue: 'deploy', description: 'Decidir se sera deploy ou destroy [deploy]')
        choice(name: 'DECISION', choices: ['deploy', 'destroy'])
    }

    stages {
        stage('Clone do Repositório') {
            steps {
                git url: 'https://github.com/bocunha/grupo-one-mmaster.git', branch: 'main'
            }
        }

        stage('Pipeline Infra') {
            steps {
                script {
                    if (DECISION.equals("destroy")){
                        stage ('Provisionando Máquinas Terraform') {
                        sh "./destroy.sh"
                        }
                    } else {
                        stage ('Removendo Máquinas Terraform') {
                            sh "./deploy.sh" 
                        }
                        stage('Criando Hosts Ansible') {
                            sh "./hosts_ansible.sh"
                        }
                        stage('Configurando HaProxy') {
                            sh "./haproxy.sh"
                        }
                        stage('Configura Cluster Kubernets') {
                            sh "./k8s.sh"
                        }
                        stage('Testa Provisionamento') {
                            sh "./test.sh"
                        }
                    }
                }
            }
        }
    }
}
    